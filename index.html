<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>After Effects Scripts Portfolio</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/overlay-system.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
    <header class="header">
        <div class="container">
            <div style="position: absolute; top: 1rem; right: 2rem; opacity: 0.7; font-size: 0.8rem; color: var(--header-subtitle); display: flex; align-items: center; gap: 0.3rem;" id="theme-indicator">
                <i data-lucide="moon" style="width: 14px; height: 14px;"></i>
                Dark Mode
            </div>
            <h1 class="site-title">After Effects Scripts Portfolio</h1>
            <p class="site-subtitle">Interactive showcase of custom After Effects scripts</p>
        </div>
    </header>

    <nav class="navigation">
        <div class="container">
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search scripts..." />
            </div>
            <div class="filters">
                <select id="category-filter">
                    <option value="">All Categories</option>
                    <option value="utility">Utility Tools</option>
                    <option value="automation">Automation</option>
                    <option value="workflow">Workflow</option>
                </select>
                <select id="sort-filter">
                    <option value="name">Sort by Name</option>
                    <option value="newest">Newest First</option>
                    <option value="category">By Category</option>
                </select>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <div id="scripts-grid" class="scripts-grid">
                <!-- Script cards will be dynamically populated here -->
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 After Effects Scripts Portfolio</p>
        </div>
    </footer>

    <script src="js/utils.js"></script>
    <script src="js/overlay-engine.js"></script>
    <script>
        // Theme detection and management
        function updateThemeIndicator() {
            const indicator = document.getElementById('theme-indicator');
            if (!indicator) return;
            
            const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            indicator.innerHTML = isDark ? 
                '<i data-lucide="moon" style="width: 14px; height: 14px;"></i> Dark Mode' : 
                '<i data-lucide="sun" style="width: 14px; height: 14px;"></i> Light Mode';
                
            // Re-initialize Lucide icons for the new icon
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }
        
        // Listen for theme changes
        function setupThemeDetection() {
            const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
            updateThemeIndicator();
            
            // Listen for changes
            mediaQuery.addEventListener('change', updateThemeIndicator);
        }
        
        // Initialize the main page
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Lucide icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
            
            setupThemeDetection();
            loadScriptsList();
            setupFilters();
            
            // Handle tag filtering from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const tagFilter = urlParams.get('tag');
            if (tagFilter) {
                // Clear the search input since we're filtering by exact tag, not searching
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.value = '';
                }
                
                // Show a message that we filtered by tag
                showTagFilterMessage(tagFilter);
                
                // Trigger the filtering
                setTimeout(() => {
                    handleFiltering();
                }, 100);
            }
        });
        
        /**
         * Show message when filtering by tag
         */
        function showTagFilterMessage(tag) {
            const container = document.querySelector('.container');
            const existingMessage = document.getElementById('tag-filter-message');
            
            // Remove existing message if any
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // Create new message
            const message = document.createElement('div');
            message.id = 'tag-filter-message';
            message.style.cssText = `
                background: var(--bg-secondary);
                border: 1px solid var(--border-color);
                border-radius: 6px;
                padding: 0.75rem 1rem;
                margin: 1rem auto;
                text-align: center;
                max-width: 500px;
                color: var(--text-secondary);
                font-size: 0.875rem;
                font-weight: 400;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.5rem;
            `;
            message.innerHTML = `
                <i data-lucide="tag" style="width: 16px; height: 16px; color: var(--text-secondary);"></i>
                <span>Showing scripts tagged with <strong style="color: var(--text-primary);">"${tag}"</strong></span>
                <button onclick="clearTagFilter()" style="margin-left: 0.5rem; padding: 0.25rem 0.75rem; background: var(--accent-color); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.75rem; font-weight: 500; transition: background 0.2s ease;" onmouseover="this.style.background='var(--accent-hover)'" onmouseout="this.style.background='var(--accent-color)'">Clear</button>
            `;
            
            // Re-initialize Lucide icons for the new icon
            if (typeof lucide !== 'undefined') {
                setTimeout(() => lucide.createIcons(), 0);
            }
            
            // Insert after navigation
            const nav = document.querySelector('.navigation');
            nav.parentNode.insertBefore(message, nav.nextSibling);
        }
        
        /**
         * Clear tag filter and reload page
         */
        function clearTagFilter() {
            window.location.href = window.location.pathname;
        }
    </script>
</body>
</html>