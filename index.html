<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>After Effects Scripts Portfolio</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/overlay-system.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div style="position: absolute; top: 1rem; right: 2rem; opacity: 0.7; font-size: 0.8rem;" id="theme-indicator">
                üåô Dark Mode
            </div>
            <h1 class="site-title">After Effects Scripts Portfolio</h1>
            <p class="site-subtitle">Interactive showcase of custom After Effects scripts</p>
        </div>
    </header>

    <nav class="navigation">
        <div class="container">
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search scripts..." />
            </div>
            <div class="filters">
                <select id="category-filter">
                    <option value="">All Categories</option>
                    <option value="utility">Utility Tools</option>
                    <option value="automation">Automation</option>
                    <option value="workflow">Workflow</option>
                </select>
                <select id="sort-filter">
                    <option value="name">Sort by Name</option>
                    <option value="newest">Newest First</option>
                    <option value="category">By Category</option>
                </select>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <div id="scripts-grid" class="scripts-grid">
                <!-- Script cards will be dynamically populated here -->
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 After Effects Scripts Portfolio</p>
        </div>
    </footer>

    <script src="js/utils.js"></script>
    <script src="js/overlay-engine.js"></script>
    <script>
        // Theme detection and management
        function updateThemeIndicator() {
            const indicator = document.getElementById('theme-indicator');
            if (!indicator) return;
            
            const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            indicator.innerHTML = isDark ? 'üåô Dark Mode' : '‚òÄÔ∏è Light Mode';
        }
        
        // Listen for theme changes
        function setupThemeDetection() {
            const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
            updateThemeIndicator();
            
            // Listen for changes
            mediaQuery.addEventListener('change', updateThemeIndicator);
        }
        
        // Initialize the main page
        document.addEventListener('DOMContentLoaded', function() {
            setupThemeDetection();
            loadScriptsList();
            setupFilters();
            
            // Handle tag filtering from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const tagFilter = urlParams.get('tag');
            if (tagFilter) {
                // Clear the search input since we're filtering by exact tag, not searching
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.value = '';
                }
                
                // Show a message that we filtered by tag
                showTagFilterMessage(tagFilter);
                
                // Trigger the filtering
                setTimeout(() => {
                    handleFiltering();
                }, 100);
            }
        });
        
        /**
         * Show message when filtering by tag
         */
        function showTagFilterMessage(tag) {
            const container = document.querySelector('.container');
            const existingMessage = document.getElementById('tag-filter-message');
            
            // Remove existing message if any
            if (existingMessage) {
                existingMessage.remove();
            }
            
            // Create new message
            const message = document.createElement('div');
            message.id = 'tag-filter-message';
            message.style.cssText = `
                background: linear-gradient(135deg, #e3f2fd, #f0f4ff);
                border: 1px solid #667eea;
                border-radius: 8px;
                padding: 1rem;
                margin: 1rem auto;
                text-align: center;
                max-width: 600px;
                color: #2d3748;
                font-size: 0.9rem;
            `;
            message.innerHTML = `
                üè∑Ô∏è Showing scripts tagged with <strong>"${tag}"</strong> 
                <button onclick="clearTagFilter()" style="margin-left: 0.5rem; padding: 0.25rem 0.5rem; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">Clear Filter</button>
            `;
            
            // Insert after navigation
            const nav = document.querySelector('.navigation');
            nav.parentNode.insertBefore(message, nav.nextSibling);
        }
        
        /**
         * Clear tag filter and reload page
         */
        function clearTagFilter() {
            window.location.href = window.location.pathname;
        }
    </script>
</body>
</html>